# version: '3.9'

services:
  mediamtx:
    image: bluenviron/mediamtx:latest
    container_name: mediamtx
    environment:
      # - MTX_WEBRTCADDITIONALHOSTS=10.5.1.21
      - MTX_WEBRTCADDITIONALHOSTS=192.168.1.166
    ports:
      - "8890:8890/udp" # SRT ingestion
      - "8889:8889"     # WebRTC signaling
      - "8189:8189/udp" # WebRTC media
    restart: always

  receiver-transcoder:
    image: video-receiver-transcoder
    container_name: video-receiver-transcoder
    ports:
      - "5554:5554/udp" # UDP stream for transcoder    
    environment:
      - RECEIVER_PORT=5554
      - WIDTH=1920
      - HEIGHT=1080
      - BITRATE=4000
      - SPEED_PRESET=ultrafast
      - SRT_IP=mediamtx
      - SRT_PORT=8890
      - STREAM_NAME=go1_camera
      - ENABLE_MONITORING=true
    depends_on:
      - mediamtx
    restart: always